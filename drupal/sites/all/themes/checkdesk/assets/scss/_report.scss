// Report 
//
// When a link is received we convert it into an embedded media "report"
//
// Compatibility: untested

$report-background-color: 				darken($light-grey, 5%);
$report-description-background-color: 	$light-grey;
$report-footer-color: 					darken($grayLighter, 15%);
$report-footnotes-background-color: 	darken($light-grey, 10%);
$report-text-color: 					$dark-grey;
$report-activity-header-color: 			darken($light-grey, 10%);


.report {
	@include ctb-clearfix;
	float: $from-direction;
	position: relative;
	margin: { top: $gutter-width; bottom: $gutter-width; }
	width: 100%; //default
	// when inside a modal window
	.modal-content & { 
		width: 92%; 
	}
	border-top: 4px solid rgba(0, 0, 0, 0.4);
	border-bottom: 1px solid rgba(0, 0, 0, 0.1);
	text-align: $alpha;
	font-size: $small-font-size;
	
	a {
		color: $report-text-color;
		&:hover {
			color: $identity;
		}
	}

	// Report actions
	#report-actions {
		position: absolute;
		top: $absolute-line-height/2;
		#{$omega}: -40px;
		// Checkdesk icon
		&:before {
			position: absolute;
			content: "";
			z-index: -1;
			top: -7px;
			bottom: 0;
			left: 0;
			right: 0;
			height: 7px;
			@include ctb-bg(#ccc, rgba(0,0,0,.1));
		}

		ul.content-actions {
			@include reset-list-style;
			// @include ctb-opacity(0.8);
			// @include transition-property(opacity);
			// @include transition-duration(0.2s);
			position: relative;
			// Dropshadow for depth
			&:before {
				position: absolute;
				content: "";
				z-index: -1;
				top: 0;
				bottom: 0;
				left: 0;
				right: 0;
				width: 10px;
				@include ctb-gradient-horizontal(rgba(0,0,0,.05), rgba(0,0,0,0));
			}


			& > li {
				display: block;
				margin-bottom: 1px;
				& > a {
					@include reset-box-model;
			    	@include ctb-bg(#eee, rgba(0,0,0,.05));
			    	display: block;
			    	padding: 16px 0 12px 0;
			    	width: 40px;
			    	text-align: center;
			    	@include transition-property(all);
			    	@include transition-duration(0.2s);
					&:hover { 
				    	color: black;
				    	text-decoration: none;
				    	@include ctb-bg(#ccc, rgba(0,0,0,.1));
				    	span { color: rgba(0,0,0,.9); }
				    }
					span {
						color: rgba(0,0,0,.6);
						&:hover {
							color: rgba(0,0,0,.9);
						}

						// Flag and share on the top of the report
						&.icon-link    			   { @include icon(link, $large-font-size); }
						&.icon-ellipsis-horizontal { @include icon(ellipsis-horizontal, $large-font-size); }
						&.icon-flag    			   { @include icon(flag, $large-font-size); }
						&.icon-share  			   { @include icon(share, $large-font-size); }
					}
					// highlight flagged reports
					&.flagged .icon-flag {
						@include icon(flag, $large-font-size, $red);
					}
				}
				// share embed
				.embed {
					&:hover { 
				    	color: black;
				    	text-decoration: none;
				    	background: none;
				    	span { color: black; }
				    }
					textarea {
						font-family: $sans-serif-font-stack;
						font-size: $small-font-size;
					}
				}



				// when dropdown is open
				&.open > a {
					@include ctb-bg(#ccc, rgba(0,0,0,.2));
				}

				// hide ajax throbber in dropdown
			    .ajax-progress-throbber {
			    	display: none;
			  	}

			} // li

			// Hover on report actions
			&:hover {
				// @include ctb-opacity(1);
			}


		} // ul
	} // report actions

	// Main report content
	.report-content {
		font-family: $sans-serif-font-stack;
		border-left: 1px solid rgba(0,0,0,.1);
		border-right: 1px solid rgba(0,0,0,.1);
		.report-media {
			background-color: rgba(0,0,0,.05);
			border-bottom: 1px solid rgba(0,0,0,.05);
			text-align: center;
			.container {
				max-width: 100%;
				// since we stack the report actions vertically
				// on media item's side
				min-height: 260px;
				text-align: $from-direction;

				.oembed-content {
					@include ctb-clearfix;
				}
				
				.oembed-content img {
					// width: $report-width-px; // enlarge photos to fit ...
				}

				.oembed--link--meedan-oembed-generic,
				.oembed--link--meedan-oembed-theme-generic {
					padding: $absolute-line-height/2 $gutter-width;
				}

				.thumbnail img {
					padding: $gutter-width 0;
				}

				.oembed-title {
					display: none;
				}
				
				.title {
					padding: 0;
				}
				
				.content {
					padding: 0;
				}
				
				.oembed-attributes {
					@include ctb-clearfix();
					padding: $absolute-line-height/4 $gutter-width;
				}
				.favicon {
					float: $alpha;
					margin-#{$omega}: $gutter-width;
				}
				.author, .domain {
					float: $alpha;
				}

				.icon-link { @include icon(link); }
				.permalink {
					float: $omega;
					a {
				      color: rgba(0,0,0,.2);
				      &:hover {
				        color: rgba(0,0,0,.4);
				        text-decoration: none;
				      }
				    }
				}

				img,
				embed,
				object,
				video,
				iframe {
					max-width: 100%;
				}

				// scale videos proportionally
				.oembed-video .oembed-content {
					position: relative;
					padding-bottom: 56.25%;
					height: 0; 
					overflow: hidden;
					embed,
					object,
					iframe {
						position: absolute;
						top: 0;
						left: 0;
						width: 100%;
						height: 100%;
					}
				}

				.twitter {
					width: 100%;
					max-width: 100%;
					display: inline-block;
					.oembed-content, .oembed-attributes {
						width: 80%;
						margin: 0 auto;
						padding: 0 $gutter-width;
					}
				}

				.youtube {
					.oembed-attributes {
						padding: 0 $gutter-width $absolute-line-height/4 $gutter-width;
					}
				}
				.facebook {
					// padding: $absolute-line-height/2 $gutter-width;
					.oembed--link--meedan-oembed-facebook > div {
						padding: $absolute-line-height/2 $gutter-width;
					}
				}

			}

		}

		.description {
			padding: $absolute-line-height/2 $gutter-width;
			font-size: $base-font-size;
			line-height: 1.4;
			color: rgba(0,0,0,.8);
		}

		.report-attributes {
			@include ctb-clearfix();
			color: rgba(0,0,0,.8);
			font-size: modular-scale(0) - modular-scale(-3); // 14px
			padding: $absolute-line-height/4 $gutter-width;

			// added by
			.added-by {
				float: $alpha;
				.separator {
					color: rgba(0,0,0,.4);
					font-size: $smaller-font-size;
				}
			}
		}
		
		.gravatar {
			img {
				vertical-align: text-bottom;
				@include ctb-square(20px);
				margin-#{$omega}: $gutter-width/3;
			}	
		}
	} // report content

	// Twitter customizations
	h3 > a[href*="twitter.com"] { 
		@include icon('twitter') {
			margin: 1px;
		}
		&:before {
			display: inline-block;
			@include transform(rotate(-19deg)); // new twitter logo :)
			font-size: inherit;
		}
	}


	// Report activity 
	.report-activity {
		font-family: $sans-serif-font-stack;
		& > header {
			@include ctb-clearfix();
			padding: $absolute-line-height/3 $gutter-width;
			cursor: pointer;
			background-color: rgba(0,0,0,.1);
			border-left: 1px solid rgba(0,0,0,.1);
			border-right: 1px solid rgba(0,0,0,.1);
			
			h3 {
				@include reset-box-model();
				float: $from-direction;
				font-family: $sans-serif-font-stack;
				font-size: modular-scale(0) - modular-scale(-5); // 16px
				font-weight: 700;
			}
			.report-status {
				float: opposite-position($from-direction);
				text-align: opposite-position($from-direction);
				font-size: modular-scale(0) - modular-scale(-5); // 16px
				font-weight: 700;
				// icon in the status
				span[class^="icon-"], span[class*="icon-"] {
					float: $alpha;
					font-weight: normal;
				}
				span.status-name {
					text-align: opposite-position($from-direction);
					overflow: visible;
					margin-#{opposite-position($from-direction)}:5px; 
				}
			}
			// header hover
			&:hover {
				background-color: rgba(0, 0, 0, 0.5);
				color: $white;
				a { color: $white; }
			}
		}

		// header status
		& > .in-progress {
			background-color: rgba(239,202,43,.2);
			color: rgba(239,202,43,1);
			a { color: rgba(239,202,43,1); }
			&:hover {
				background-color: rgba(239,202,43,1);
				span[class^="icon-"], span[class*="icon-"], a {	color: $white; }
			}
		}
		& > .undetermined {
			background-color: lighten($orange, 30%);
			a { color: darken($orange, 10%); }
			&:hover {
				background-color: lighten($orange, 20%);
				span[class^="icon-"], span[class*="icon-"], a {	color: darken($orange, 10%); }
			}
		}
		& > .verified {
			background-color: rgba(0,140,0,.2);
			color: rgba(0,140,0,1);
			a { color: rgba(0,140,0,1); }
			&:hover {
				background-color: rgba(0,140,0,.8);
				span[class^="icon-"], span[class*="icon-"], a {	color: $white; }
			}
		}	
		& > .false {
			background-color: lighten($red, 50%);
			a { color: $red; }
			&:hover {
				background-color: lighten($red, 40%);
				span[class^="icon-"], span[class*="icon-"], a {	color: darken($red, 10%); }
			}
		}

		// report activity
		// fact-checking log
		.activity-wrapper {
			display: none;
			@include ctb-clearfix;
			background-image: $striped_lens;
			border-left: 1px solid rgba(0,0,0,.1);
			border-right: 1px solid rgba(0,0,0,.1);
			
			// add styles for load more pager
    		@include ctb-load-more-pager;


			// activity items
			.view-content {
				padding: 0 $gutter-width;
				.activity {
					@include ctb-clearfix;
					margin-#{$from-direction}: $gutter-width/2;
					border-top: 1px dotted rgba(0,0,0,.1);
					&:first-child { border-top: 0px none; }
					color: rgba(0,0,0,.8);
					line-height: 1.3;
					header {
						@include ctb-clearfix;
						position: relative;
						.actor {
							display: inline-block;
							width: 10%;
							padding-top: $absolute-line-height/3;
							padding-#{$omega}: $gutter-width*2;
							text-align: $omega;
							vertical-align: top;
							font-weight: 700;
							color: rgba(0,0,0,.6);
							@include ctb-break-words;
						}
						.activity-inner-wrapper {
							position: relative;
							display: inline-block;
							width: 62%;
							padding: $absolute-line-height/3 0 $absolute-line-height 0;
							padding-#{$alpha}: $gutter-width*2;
							border-#{$from-direction}: 4px solid rgba(0,0,0,.1);
						}
						.icon {
							position: absolute;
							display: inline-block;
							top: 6px;
							border-radius: 50%;
							width: 24px;
							line-height: 24px;
							height: 24px;
							margin-#{$from-direction}: -36px;
							background-color: $white;
							span[class^="icon-"], span[class*="icon-"] {
							    text-align: center;
							    position: absolute;
							    width: 100%;
							    height: 100%;
							    &:before {margin: 0;}
							}
						}
						.title {
							display: inline-block;
							width: 97%;
							p { 
								margin: 0;
								margin-bottom: $absolute-line-height/2; 
								&:last-child {
									margin-bottom: 0; 
								}
							}
							.verified { 
								color: rgba(0,140,0, 1);
							}
							.in-progress { 
								color: rgba(239,202,43, 1);
							}
							.undetermined { 
								color: $orange; 
							}
							.false { 
								color: $red; 
							}
						}
						.time {
							padding: $absolute-line-height/3 0;
							position: absolute;
							top: 0;
							#{$omega}: $gutter-width;
							text-align: $omega;
							width: 20%;
							color: rgba(0,0,0,.3);
							font-size: modular-scale(0) - modular-scale(-3); // 14px
						}
					}
				}
			}

			.activity-list-footer {
				padding: 0 $gutter-width;
				color: rgba(0,0,0,.6);
				a {
					color: $link-color;
				}
			}
		} // activity wrapper

		section#comment-form {
			@include ctb-clearfix;
			border-top: 1px solid rgba(0,0,0,.1);
			padding: 0 $gutter-width;
			label {
				display: none;
			}
			form { 
				
				textarea {
					float: none;
					@include ctb-clearfix;
				}
			}
		}
	} // report activity

	// Activity header when open
	.open > .in-progress {
		background-color: rgba(239,202,43,1);
		span[class^="icon-"], span[class*="icon-"], a {	color: $white; }
	}
	.open > .verified {
		background-color: rgba(0,140,0,.8);
		span[class^="icon-"], span[class*="icon-"], a {	color: $white; }
	}

	// Report status icons in activity log's header
	$position:  "before";
	@if $from-direction == left {
		$position: "after";
	}
	@if $from-direction == right {
		$position: "before";
	}
	// verified
	.icon-ok-sign { 
		color: rgba(0,140,0,1);
		@include icon(ok-sign, $base-font-size);
	}
	// in-progress
	.icon-random { 
		color: rgba(239,202,43,1);
		@include icon(random, $small-font-size);
	}
	.icon-circle { 
		color: rgba(239,202,43,1);
	}
	// undetermined
	.icon-question-sign { 
		color: $orange; 
		@include icon(question-sign, $base-font-size);
	}
	// false
	.icon-remove-sign { 
		color: $red; 
		@include icon(remove-sign, $base-font-size);
	}

} // report

// Report status color bar at the top of a report
article.in-progress {
	border-top: 4px solid $yellow;
}


// Sensitive content handling
div.sensitive-hide {
  display: none;
}

.sensitive-notification {
	display: table-cell;
	width: 60%;
	height: 200px;
	text-align: center;
	vertical-align: middle;
	background: none !important;
    .sensitive-notification-text {
    	color: $grayDark;
    	padding: $absolute-line-height/2 $gutter-width/2;
    }
    .sensitive-notification-link {
    	padding: $absolute-line-height/2 $gutter-width/2;
    	a {
    		@include button($grayLight, 18px);
    	}
    }
}

.report-row .sensitive-notification {
	font-family: $sans-serif-font-stack;
	background-color: rgba(0,0,0,.05) !important;
}