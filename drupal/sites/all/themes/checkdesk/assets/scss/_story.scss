// Citizen's view of Story page 
// aka Discussion Node 

@mixin vertical-margin($width) {
  margin: { top: $width; bottom: $width; } 
}

@mixin layout-story($width, $context) {
  // @include span-columns($width, $context, $gutter-width);
  @content;
  .update-row { 
    // @include vertical-margin($base-font-size);
    // @include span-columns($width, $context, $gutter-width);
    // @debug $width;
    .update-body {
      @include span-columns(14); 
      float: $omega;
      min-height: 220px;
      margin-#{$omega}: 0;
    }
    .update-footer {
      @include span-columns(4);
      float: $alpha;
      // width: 160px;
      .livefyre-wrapper {
        // @include span-columns($width, $width);
      }
    }
  }
}

.node-type-discussion, .page-liveblog {
  #main {
    @include layout-story($container-width, $container-width);
  }
}

// "Published" updates
.updates {
  margin-top: $absolute-line-height/2;
  .update-row {
    margin-bottom: $base-line-height;
    border-top: 2px solid rgba(0,0,0,.2);
    .update-info {
      @include span-columns(4);
      font-family: $sans-serif-font-stack;
      color: rgba(0,0,0,.2);
      border-top: 4px solid rgba(0,0,0,.2);
      margin-bottom: $absolute-line-height;
      padding-top: $absolute-line-height/2;
      text-transform: uppercase;
      font-weight: 700;
      font-size: modular-scale(0) - modular-scale(-3); // 14px
      @if $from-direction == 'left' {
        letter-spacing: 0.15em;
      }
      // update number
      b {
        display: block;
        padding: $absolute-line-height/2 0;
        font-size: $xxx-large-font-size;
        @if $from-direction == 'left' {
          letter-spacing: -0.08em;
        }
      }
    }
  }
}

// ark_20130126: Omega not set, not sure why?
$omega: opposite-position($alpha);

.story {
  @include ctb-clearfix;
  text-align: $alpha;
  margin-bottom: $absolute-line-height/2;

  #story-actions {
    ul.content-actions {
      @include reset-box-model;
      @include reset-list-style;
      display: block;
      @include ctb-bg(#fff, rgba(255, 255, 255, 0.6));
      @include border-radius(4px);
      padding: $absolute-line-height/4 $gutter-width;
      margin-bottom: $absolute-line-height/2;
      li {
        display: inline-block;
        a {
          @include checkdesk-button($grayLight);
          @include button-size(13px);
        }
      }
    }
  }

  .story-meta {
    @include ctb-clearfix;
    border-top: 4px solid rgba(0,0,0,.9);
    padding-top: $absolute-line-height/2;
    font-family: $sans-serif-font-stack;
    color: rgba(0,0,0,.6); 
    .separator {
      color: rgba(0,0,0,.3); 
    }
    .gravatar {
      margin-#{$omega}: $gutter-width/2;
    }
    a { 
      font-weight: 700;
      color: rgba(0,0,0,.6); 
      &:hover { 
        color: rgba(0,0,0,.8); 
        text-decoration: none;
      }
    }
    .story-at {
      float: $alpha;
    }
    .story-commentcount {
      @include icon(comments, $base-font-size);
      float: $omega;
      font-weight: 700;
      color: rgba(0,0,0,.3);
      a {
        color: rgba(0,0,0,.3);
        &:hover {
          color: rgba(0,0,0,.8);
        }
      }
      @if $from-direction == 'left' {
        font-size: modular-scale(0) - modular-scale(-3); // 14px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: rgba(0,0,0,.3);
      }
    }
  }

  .story-by {
    font-size: $larger-font-size;
    margin-top: $absolute-line-height/4;
    margin-bottom: $absolute-line-height/2;
    a { @include ctb-linkColor($grayLight); }
  }

  .story-context {
    font-size: $small-font-size;
    line-height: $relative-line-height;
  }

  // Message displayed when a story has drafted updates
  .story-drafts {
    color: $red;
    font-size: $small-font-size;
    font-style: italic;
  }
  
  // The current blogger information
  .story-blogger {
    @include ctb-clearfix;
    margin: $absolute-line-height/2 0;

    .avatar {
      display: inline-block;
      padding: $absolute-line-height/2 0;
      .user-picture {
        display: inline-block;
        margin-#{$omega}: $gutter-width;
        img {
          display: inline-block;
          vertical-align: text-bottom;
          @include ctb-square(20px);
          margin-#{omega}: $gutter-width/3;
        }
      }
      a { @include ctb-linkColor($grayLight); }
    }

    .blogger-status {
      display: inline-block;
      margin-#{$alpha}: $gutter-width;

      .blogger-status-indicator {
        @include ctb-square(10px);
        @include border-radius(10px);
        display: inline-block;
        background-color: $grayLight;
      }

      .blogger-status-text {
        @include ctb-bg(#fff, rgba(255, 255, 255, 0.6));
        @include border-radius(4px);
        display: inline-block;
        padding: $absolute-line-height/2 $gutter-width;
        margin-#{$alpha}: $gutter-width;
      }
      
    }
    // status indicator colors
    .story-blogger-status-offline .blogger-status-indicator { background-color: $grayLight; }
    .story-blogger-status-online .blogger-status-indicator { background-color: $green; }
  }

  figure {
    margin: $absolute-line-height/2 0;
  }

  .story-body {  
    @include ctb-clearfix;
    margin: $absolute-line-height/2 0;
    font-size: modular-scale(0) - modular-scale(-5); // 16px;
    color: rgba(0,0,0,.9);
    line-height: 1.6;
    text-shadow: 0 1px 1px rgba(255,255,255,.35);
    p {
      margin: $base-line-height/4 0;
      &:first-child {
        margin: 0 0;
      }
    }
  }

  // compose / create update form
  .compose-update-form {
    margin: $absolute-line-height 0;
    & > h2 {
      @include icon("pencil", $large-font-size, $white, $icon-position);
      font-family: $sans-serif-font-stack;
      font-size: $large-font-size;
      margin-bottom: 0;
      padding: $absolute-line-height/2 $gutter-width;
      cursor: pointer;
      color: $white;
      background-color: rgb(239,202,43);
      @include border-radius(4px);
    }

    .node-post-form {
      display: none;
      border-top: 4px solid rgb(239,202,43);
      padding: 0 $gutter-width;
      background-image: $striped_lens;
      input[type='submit'] {
        @include checkdesk-button($identity);
      }
    }
  }
  .open > h2 {
    color: rgba(0,0,0,.9);
    @include icon("pencil", $large-font-size, rgba(0,0,0,.9), $icon-position);
    background-color: rgba(239,202,43,.2);
    @include border-radius(4px 4px 0 0);
  }

  .story-updates-wrapper {
    // add styles for load more pager
    @include ctb-load-more-pager;
  }

  .story-footer {
    @include ctb-clearfix;
    display: block;
    margin-top: $absolute-line-height/2;
    padding: $absolute-line-height/4 0;
    border-top: 1px solid rgba(0,0,0,.1);
    color: rgba(0,0,0,.2);
    font-family: $sans-serif-font-stack;
    font-size: $small-font-size;
    cursor: pointer;
    a {
      color: rgba(0,0,0,.2);
      &:hover {
        color: rgba(0,0,0,.4);
        text-decoration: none;
      }
    }
    .story-continue {
      @include icon('link', $small-font-size);
      float: $alpha;
      
      .permalink {
        display: none;
      }
    }

    .story-updated-at {
      float: $omega;
      text-align: $omega;
      font-style: italic;
    }
    &:hover {
      .story-continue .permalink { display: inline-block; }
    }
  }

  .story-comments {
    margin-top: $absolute-line-height;
    .livefyre-header, .fb-comments-header {
      @include icon(comments, $large-font-size);
      font-family: $sans-serif-font-stack;
      font-size: $large-font-size;
      @if $from-direction == 'right' {
        font-size: $larger-font-size;
      }
      color: rgba(0,0,0,.8);
      background-color: rgba(0,0,0,.02);
      padding: $absolute-line-height/2 $gutter-width/2;
      @include border-radius(4px);
      cursor: pointer;
      &:hover {
        color: $white;
        background-color: rgb(239,202,43);
      }
    }
    .fb-comments {
      margin-top: $absolute-line-height/2;
    }
  }
}

// story lists
.stories {
  .story-row {
    margin-bottom: $absolute-line-height/4;
    padding: $absolute-line-height/2 0;
    border-bottom: 1px solid rgba(0,0,0,.05);
    &:first-child {
      padding: 0 0 $absolute-line-height/2 0;
    }
    &:last-child {
      margin-bottom: 0;
      border-bottom: 0px none;
    }

    a {
      color: $grey;
      color: rgba(0,0,0,.6);
      &:hover {
        color: $dark-grey;
        color: rgba(0,0,0,.8);
        text-decoration: none;
      }
    }

    // hide by default
    figure {
      display: none;
    }

    h3 {
      @include reset-box-model;
      font-size: modular-scale(0) - modular-scale(-3); // 14px;
      @if $from-direction == 'right' {
        font-size: $base-font-size;
      }
      font-weight: 700;
      line-height: 1.4;
    }
    .story-desc {
      display: none;
    }
  }

  // show featured image on the first item
  .views-row-first {
    figure {
      display: block;
      margin-bottom: $absolute-line-height/2;
    }
  }
}
