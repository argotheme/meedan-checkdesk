// Page with a sidebar
// Implementations: The story page as seen by a journalist (create update)
//
// By default, there is only one column.
// In larger breakpoints the primary width $pw and secondary $sw diverge to create two columns.
@mixin sidebar($sw, $pw, $break: $cw) {

  body.sidebar-first {
    #main {
      background-color: $light-grey;
      @include span-columns($break, $break); //outermost container
      @include pad(0,0, $break); // override story.scss

      // 2. The sidebar column
      #sidebar-first.column {
        background-color: white;
        margin-top: 100px;
        @include span-columns($sw + 1, $break, $gw); // sidebar width
        margin-#{opposite-position($from-direction)}: 0;
        @include clearfix;
        position: relative;
        z-index: 0;
        @include box-shadow($grey 2px -1px 4px);
        @include reports-filter($sw);
      }

      // 3. The primary content column
      div#content .inner {
        @include span-columns($pw - 1 omega, $break);
        @include pad(0,0, $break);
        margin-#{$from-direction}: 0;
        background-color: white;

        // this needs to move to typography.scss
        h1.title {
          margin-top: 0;
          padding-top: 2em;
          font-size: $xxx-large-font-size;
        }

        p {
          @include span-columns($pw, $pw);
          clear: both;
        }
        
        // The current status and blogger information
        .story-status, .story-blogger {
          @include span-columns($pw, $pw);
          @include clearfix;
        }

        // The main post form
        #block-checkdesk-core-post {
          @include span-columns($pw, $pw);
          position: relative;
          clear: both;

          form {
            @include span-columns($pw, $pw, $gw);
          }
        }

        // "Published" updates
        #block-views-desk-updates-block {
          @include span-columns($pw, $pw);
          // margin-top: $base-font-size;
          // background: white;
          // padding: $gw; // children are no longer aligned to grid ...
        }
      }
    }
  }
}

// ==========================================================================
// Default: up to break-small
@include sidebar($cw, $cw); // full width for secondary and primary cols

// ==========================================================================
// Breakpoint: small
@include at-breakpoint($break-small) {
  $break: $break-small;
  $sw: 4;
  $pw: $break-small - $sw;

  body.sidebar-first #main {
    @include span-columns($break, $break); //reset
    @include pad(0, 0, $break); 
  }

  @include sidebar($sw, $pw, $break); // reapply sidebar
}


@include at-breakpoint($break-medium) {
  $break: $break-medium;
  $sw: 6;
  $pw: $break-medium - $sw;
  body.sidebar-first #main {
    @include span-columns($break, $break); // reset outer
    @include pad(0,0, $break); // reset
  }
  @include sidebar($sw, $pw, $break); // reapply sidebar
}  

@include at-breakpoint($break-large) {
  $break: $break-large;
  $sw: 7;
  $pw: $break-large - $sw;
  body.sidebar-first #main {
    @include span-columns($break, $break); // reset
    @include pad(0, 0, $break); // reset
  }
  @include sidebar($sw, $pw, $break); // reapply sidebar
}