// 1. Drupal Navigation at the very top.
// 2. Checkdesk #main-menu navigation

// Nav icons
// This will have to be refined with improved markup. href-based selector is fragile. - CGB
@mixin nav-icons($size: $xsmall-font-size) {
  // home
  li.menu-477 .icon-home { @include icon("home", $size) { @include reset-box-model; } }
  // add a story 
  li a[href*="discussion"] { @include icon("file", $size); }
  
  li.menu-567 > a { 
    before: { content: "■■■"; }
  }

  // add a post
  li a[href*="post"] { @include icon("pencil", $size); }
  // add a report
  li.menu-472 a { @include icon("bookmark", $size); }
  // info menu
  li a[href*="sub"] { @include icon("info-sign", $size); }
}

// Home link
// Special shine
// ... not in the spec
// li.menu-477 {
  // @include gradient(rgba(white, 0.1), rgba(white, 0.2));
// }

// Nav item container
//
// This makes any element behave properly with 1 or more <.nav-item> children.
// It is used on both the outer parent and *some* children (where it is necessary to override).
// This helps standardize the implementation of the contained nav-items
// This is necessary because some nav-items are h2s, a, or divs.
@mixin nav-item-container() {
  @include reset-box-model;
  line-height: $base-line-height;
  float: $from-direction;
  display: inline-block;
  clear: none;
  position: relative;
  z-index: 1;
  background: $nav-container-bkg-color;
}

// "Nav item" — single nav unit in the navigation
//
// Could be a dropdown, header, anchor or div; and can contain an img.
@mixin nav-item { 
  @include reset-box-model;
  display: inline-block;
  float: $from-direction;  
  position: relative;
  z-index: $zindexDropdown - 1; 
  border-#{$from-direction}: 1px solid rgba(white, 0.29);
  & > a {
    font-weight: 100;
    padding: 0 $nav-gutter;
    letter-spacing: 1px;
    text-decoration: none;
    line-height: $nav-height - 4;
    color: $nav-color;
    display: inline-block;
    &:hover {
      color: $nav-active-color;
    }
  }

  // Transitions
  @include bb-transition($nav-color, $nav-active-color, '0.2s', 'color');
  @include bb-transition($nav-bkg-color, $nav-active-bkg-color, '0.2s', 'background-color');
  
  // Hovering on the chunky element (could be an <h2> or an <li> or an <a>)
  &:hover {
    background-color: $nav-hover-bkg-color;
    color: $nav-hover-color;
  }

  &.active {
    background-color: $nav-active-bkg-color;
    color: $nav-active-color;
  }

  // An anchor inside the chunky block
  &.active > a, 
  & > a.active {
    color: $nav-active-color;
    @include border-radius($radius $radius 0 0);
    font-weight: 500;
  }

  span.avatar img { // images in nav items
    @include reset-box-model;
    width: $base-font-size;
    height: $base-font-size;
    // border: 1px solid red;
  }

  @content
}


// This nav contains two rows of nav-items with icons.
nav[role="navigation"] {
  float: $from-direction;
  background-color: $nav-container-bkg-color;
  width: 100%;

  li:last-of-type:after {
    float: $from-direction;
    clear: both;
    display: block;
  }

  // Apply nav icons
  // Warning: The line height must remain more than the icons' generated height.
  @include nav-icons(15px);

  // set the distance from the bottom of the button top of the dropdown
  .dropdown-menu, 
  #block-views-my-notifications-block .content {
    top: $nav-line-height*2;
  }

  .nav {
    margin: 0;
    padding: 0;

    @include nav-item-container; // A container for some nav items
    & > div  {
      @include nav-item-container; // reapply container reset
      h2 {
        @include nav-item; // Why is this nav item an h2? CGB
      }
    }
    & > a.btn, // the user menu button
    & > li { // default: the rest of the li's in the navigation
      @include nav-item;
    }
  }

  #user-menu {
    margin-#{$omega}: $nav-gutter;
    a {
      font-weight: 100; // should not be necessary
    }
  }

  #navigation-region,
  #info-menu,
  #user-menu {
    float: $omega; // at a larger breakpoint these fall in line
    // clear: $alpha;
    img {
      width: $nav-icon-height;
      height: $nav-icon-height;
      margin-#{$alpha}: $nav-gutter;
    }

    // Position the dropdown menu
    .dropdown-menu {
      // #{opposite-position($from-direction)}: 0;
      // #{$from-direction}: auto;
    }
  }

  // The installation page link
  // ==============================================================
  #info-menu {
    li {
      a.dropdown-toggle {
        margin-#{opposite-position($from-direction)}: 10px;
      }
    }
    li.open {
      a.dropdown-toggle {
        text-shadow: none;
      }
    }
  }

  // Notifications 
  // FIXME has a different structure than the other <ul>'s...
  #navigation-region {
    #block-views-my-notifications-block {
      @include nav-item-container;
      h2 {
        @include nav-item;
        font-size: $nav-font-size; // these should not be necessary once this is an <a>
        font-weight: 100;
        padding: 2px;
        .notifications-label {
          cursor: pointer;
        }
        .notifications-count {
          display: inline-block;
          color: $notification-count-color;
          span {
            padding: 1px 5px;
            background: #296182;
            @include border-radius(5px);
          }
        }
      }
    }
  }
}

// =======================================================================
// Drupal toolbars at the very top
//
div.region-page-top {
  #toolbar {
    // This can be cleaned up with toolbar css is removed.
    @include box-shadow(0 0 0 0); // disable box shadow
    padding: 0;
    margin: 0;
    overflow: auto;
    position: static; // override drupal fixed positioning
    background: $nav-container-bkg-color;
    li {
      @include reset-box-model;

      a { 
        color: $nav-color; 
        padding: $gw;
      } 
    }

    div.toolbar-menu {
      padding: 0;
      background-color: $nav-container-bkg-color;
    }
  }
}